# 网络层
网络层的分组是数据报, 一般由路由器把报文段封装成数据报, 或者从数据报提取报文段给运输层.

## 概述
## 转发与路由选择
- 转发: 分组到达路由器的输入链路时, 路由器把该分左右启动到合适的输出链路.
- 路由选择: 根据路由选择算法, 网络层决定分组从发送方到接收方的路径.

路由器根据**路由表(forwarding table)**转发分组, 如下图所示, 分组的首部值会映射到某一个输出链路. 名词使用上我们通通讲网络层(第三层)的分组交换机统称为路由器.
![](https://github.com/huanruiz/PunchingCS/blob/master/images/cn4_1.png)

## 虚电路和数据报网络
仅在网络层提供连接服务的计算机网络叫**虚电路网络(Virtual-Circuit)**, 仅在网络层提供无线连接服务的计算机网络叫**数据报网络(datagram network)**. 

### 虚电路网络
因特网是数据报网络, 但是许多其他网络结构(ATM, 帧中继体系结构)是虚电路网络. 虚电路组成如下:
1. 源和目的主机之间的路径
2. 沿该路径每段链路的VC号
3. 沿该路径每台路由器的转发表表项, VC号由路由器中的转发表决定.

虚电路主要有三个阶段:
1. 虚链路建立. 网络层决定发送方接收方路径, 为每条链路决定VC号, 并在路径中的路由器转发表中添加表项.
2. 数据传送. 分组在虚电路流动.
3. 虚电路拆除. 发送方通知网络层终止虚电路, 网络层遍通知接收方结束呼叫, 并更新路径上路由器的转发表.

对比运输层的连接, 可以发现虚电路的连接是涉及整个路径的, 路径上所有的路由器都参与虚电路的建立, 并且都知道经过它的所有虚电路.

### 数据报网络
端系统为分组加上目的端系统的地址, 并把分组推进网络中. 每个路由器根据分组的目的地址转发分组, 转发表保存了目的地址到链路接口的映射. 保存精确的所有IP地址(假设32位)是不可能的, 所以路由表是根据**最长前缀匹配规则**来匹配这个映射.

## 路由器工作原理
